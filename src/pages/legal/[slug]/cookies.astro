---
import Layout from '../../../layouts/Layout.astro';
import { getClientBundle } from '../../../lib/db/queries';

const { slug } = Astro.params;

const result = await getClientBundle(slug as string);
const bundle = (result?.seo_bundle ?? result?.bundle ?? result) as any;

console.log(`[OBS]  Generando Pol铆tica de Cookies para: ${slug}`);

const legal = bundle?.legal;
const brandName = bundle?.brand?.name ?? 'Este negocio';

// Por defecto: si no existe legal o no existe includeCookieBanner, asumimos true
const includeCookieBanner =
  typeof legal?.includeCookieBanner === 'boolean'
    ? legal.includeCookieBanner
    : true;

const websiteUrl =
  bundle?.brand?.url ??
  bundle?.locations?.[0]?.gbp?.mapsUrl ??
  '';

const contactEmail =
  legal?.email ??
  bundle?.locations?.[0]?.email ??
  '';
---

<Layout bundle={bundle} ops={bundle?.ops}>
  <main class="legal-content">
    <h1>Pol铆tica de Cookies</h1>

    {includeCookieBanner ? (
      <>
        <section>
          <h2>驴Qu茅 son las cookies?</h2>
          <p>
            Las cookies son peque帽os archivos que se almacenan en el dispositivo del usuario cuando visita
            un sitio web. Sirven para recordar informaci贸n sobre la navegaci贸n y pueden utilizarse para mejorar
            la experiencia del usuario, analizar el uso del sitio o mostrar contenidos personalizados.
          </p>
        </section>

        <section>
          <h2>Tipos de cookies</h2>
          <p>
            Este sitio puede utilizar cookies t茅cnicas (necesarias para su funcionamiento), cookies de an谩lisis
            (para medir y analizar la navegaci贸n) y, en su caso, cookies de personalizaci贸n o publicitarias,
            dependiendo de la configuraci贸n y servicios integrados.
          </p>
        </section>

        <section>
          <h2>Gesti贸n de cookies</h2>
          <p>
            El usuario puede permitir, bloquear o eliminar las cookies instaladas mediante la configuraci贸n del
            navegador. La desactivaci贸n de cookies puede afectar al correcto funcionamiento de algunas secciones.
          </p>
        </section>

        <section>
          <h2>Consentimiento</h2>
          <p>
            Cuando sea aplicable, el usuario podr谩 aceptar o rechazar el uso de cookies no necesarias a trav茅s del
            mecanismo de consentimiento mostrado en el sitio.
          </p>
        </section>

        <section>
          <h2>M谩s informaci贸n</h2>
          <p>
            Para cualquier duda relacionada con el uso de cookies, puede contactar con:
            {' '}
            {contactEmail || 'el canal de contacto del sitio'}.
          </p>
          <p>
            Sitio web: {websiteUrl || 'Pendiente'}.
          </p>
        </section>
      </>
    ) : (
      <>
        <section>
          <p>
            Este sitio no utiliza un banner de cookies configurado. Si se incorporan cookies no necesarias en el futuro,
            se habilitar谩 el mecanismo de consentimiento correspondiente.
          </p>
        </section>

        <section>
          <p>
            Para cualquier duda, puede contactar con: {contactEmail || 'el canal de contacto del sitio'}.
          </p>
        </section>
      </>
    )}
  </main>
</Layout>

<style>
  .legal-content {
    max-width: 800px;
    margin: 4rem auto;
    padding: 2rem;
    font-family: system-ui, -apple-system, sans-serif;
    line-height: 1.6;
    color: #2d3436;
  }
  
  .legal-content h1 {
    font-size: 2.5rem;
    margin-bottom: 2rem;
    color: #2d3436;
    border-bottom: 2px solid #0984e3;
    padding-bottom: 0.5rem;
  }

  .legal-content section {
    margin-bottom: 2.5rem;
  }

  .legal-content h2 {
    font-size: 1.5rem;
    color: #2d3436;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  .legal-content p {
    margin-bottom: 1rem;
    color: #636e72;
  }
</style>
